{% load static %}
<h1>Hello, {{ user.full_name }}!</h1>

<h1>Ratings for {{ restaurant.nama_restoran }}</h1>

<h2>Restaurant Details</h2>
<p>Location: {{ restaurant.lokasi }}</p>
<p>Atmosphere: {{ restaurant.jenis_suasana }}</p>
<p>Restaurant Crowd Level: {{ restaurant.keramaian_restoran }}</p>
<p>Serving Style: {{ restaurant.jenis_penyajian }}</p>
<p>All You Can Eat or A La Carte: {{ restaurant.ayce_atau_alacarte }}</p>
<p>Average Meal Price: {{ restaurant.harga_rata_rata_makanan }}</p>
<p>
    <img src="{{ restaurant.gambar }}" alt="Image of {{ restaurant.nama_restoran }}" style="width:300px;height:auto;">
</p>


<h1>Menus for {{ restaurant.nama_restoran }}</h1>
<ul>
    {% for menu in reviewed_menus %}
    <li>
        <strong>{{ menu.nama_menu }}</strong> - {{ menu.harga }} IDR <br>
        <em>Category:</em>
        <ul>
            {% for category in menu.cleaned_clusters %}
            <li>{{ category }}</li>
            {% endfor %}
        </ul>
    </li>
    {% endfor %}
</ul>



<h2>Restaurant-Wide Ratings</h2>
{% for rating in restaurant_ratings %}
    <p>User: {{ rating.user.username }}</p>
    <p>Rating: {{ rating.rating }} stars</p>
    <p>Review: {{ rating.pesan_rating }}</p>
    <button class="edit-rating" data-id="{{ rating.id }}">Edit</button>
    <button class="delete-rating" data-id="{{ rating.id }}">Delete</button>
    <hr>
{% endfor %}

<!-- Button to open modal for adding a new rating -->
<button id="add-rating-btn">Add Rating</button>
<!-- Modal for adding rating -->
<div id="rating-modal" style="display: none;">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>Add a Rating</h2>
        <div id="modal-body">
            <!-- The content from add_rating.html will be loaded here via AJAX -->
        </div>
    </div>
</div>
<script>

    document.addEventListener("DOMContentLoaded", function () {
        const addRatingBtn = document.getElementById("add-rating-btn");
        const ratingModal = document.getElementById("rating-modal");
        const modalBody = document.getElementById("modal-body");
        const closeModal = document.querySelector(".close-modal");
    
        // Open the modal when "Add Rating" button is clicked
        addRatingBtn.addEventListener("click", function () {
            fetch(`/ratings/restaurants/{{ restaurant.id }}/add-rating/`)
                .then(response => response.text())
                .then(data => {
                    modalBody.innerHTML = data;
                    ratingModal.style.display = "block";
                });
        });
    
        // Close the modal when the "x" button is clicked
        closeModal.addEventListener("click", function () {
            ratingModal.style.display = "none";
        });
    
        // Handle form submission with AJAX
        document.body.addEventListener("submit", function (event) {
            if (event.target.id === "rating-form") {
                event.preventDefault();
    
                const formData = new FormData(event.target);
                fetch(event.target.action, {
                    method: "POST",
                    body: formData,
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert("Rating added successfully!");
                            ratingModal.style.display = "none";
                            window.location.reload();  // Reload the page to show the new rating
                        } else {
                            alert("Error: " + JSON.stringify(data.errors));
                        }
                    });
            }
        });
    
        // Handle delete and edit actions (assume there are buttons with class "edit-rating" and "delete-rating")
        document.body.addEventListener("click", function (event) {
            if (event.target.classList.contains("delete-rating")) {
                const ratingId = event.target.getAttribute("data-id");
                fetch(`/ratings/${ratingId}/delete/`, { method: "POST" })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert("Rating deleted successfully!");
                            window.location.reload();
                        }
                    });
            }
    
            if (event.target.classList.contains("edit-rating")) {
                const ratingId = event.target.getAttribute("data-id");
                fetch(`/ratings/${ratingId}/edit/`)
                    .then(response => response.text())
                    .then(data => {
                        modalBody.innerHTML = data;
                        ratingModal.style.display = "block";
                    });
            }
        });
    });
    

</script>
